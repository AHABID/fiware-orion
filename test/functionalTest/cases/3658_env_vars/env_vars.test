# Copyright 2020 Telefonica Investigacion y Desarrollo, S.A.U
#
# This file is part of Orion Context Broker.
#
# Orion Context Broker is free software: you can redistribute it and/or
# modify it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# Orion Context Broker is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
# General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with Orion Context Broker. If not, see http://www.gnu.org/licenses/.
#
# For those usages not covered by this license please contact with
# iot_support at tid dot es

--NAME--
broker env vars set on command line

--SHELL-INIT--

--SHELL--

#
# 01. Get the extended usage from the broker withut any alterations - see default state
# 02. Set three env vars and add a few CLI params and with that - get the extended usage - see the origin and value of the modified parameters
#

echo "01. Get the extended usage from the broker withut any alterations - see default state"
echo "====================================================================================="
contextBroker -U
echo
echo


echo "02. Set three env vars and add a few CLI params and with that - get the extended usage - see the origin and value of the modified parameters"
echo "============================================================================================================================================"
export ORION_REQ_TIMEOUT=20
export ORION_HTTP_TIMEOUT=100
export ORION_IN_REQ_PAYLOAD_MAX_SIZE=1024
contextBroker -fg -logLevel DEBUG -pidpath /opt/orion/orion.pid -U
echo
echo


--REGEXPECT--
01. Get the extended usage from the broker withut any alterations - see default state
=====================================================================================
Extended Usage: contextBroker  [option '-U' (extended usage)]                                                                                      TRUE /FALSE/                                                           (command line argument)
                               [option '-u' (usage)]                                                                                               FALSE /FALSE/                                                          (default value)
                               [option '--help' (show help)]                                                                                       FALSE /FALSE/                                                          (default value)
                               [option '--version' (show version)]                                                                                 FALSE /FALSE/                                                          (default value)
                               [option '-logDir' <log file directory>]                                             ORION_LOG_DIR                   '/tmp/'                                                                (not altered)
                               [option '-t' <trace level>]                                                         ORION_TRACE                     '' /'(null)'/                                                          (default value)
                               [option '-logLevel' <initial log level (NONE, FATAL, ERROR, WARN, INFO, DEBUG)>]    ORION_LOG_LEVEL                 'WARN' /'WARN'/                                                        (default value)
                               [option '-logAppend' (append to log-file)]                                          ORION_LOG_APPEND                FALSE /FALSE/                                                          (default value)
                               [option '-fg' (don't start as daemon)]                                              ORION_FOREGROUND                FALSE /FALSE/                                                          (default value)
                               [option '-localIp' <IP to receive new connections>]                                 ORION_LOCALIP                   '0.0.0.0' /'0.0.0.0'/                                                  (default value)
                               [option '-port' <port to receive new connections>]                                  ORION_PORT                      1026 /1026/                                                            (default value)
                               [option '-pidpath' <pid file path>]                                                 ORION_PID_PATH                  '/tmp/contextBroker.pid' /'/tmp/contextBroker/                         (default value)
                               [option '-dbhost' <database host>]                                                  ORION_MONGO_HOST                'localhost' /'localhost'/                                              (default value)
                               [option '-rplSet' <replica set>]                                                    ORION_MONGO_REPLICA_SET         '' /''/                                                                (default value)
                               [option '-dbuser' <database user>]                                                  ORION_MONGO_USER                '' /''/                                                                (default value)
                               [option '-dbpwd' <database password>]                                               ORION_MONGO_PASSWORD            '' /''/                                                                (default value)
                               [option '-dbAuthMech' <database authentication mechanism (either SCRAM-SHA-1 or ]   ORION_MONGO_AUTH_MECH           'SCRAM-SHA-1' /'SCRAM-SHA-1'/                                          (default value)
                               [option '-dbAuthDb' <database used for authentication>]                             ORION_MONGO_AUTH_SOURCE         '' /''/                                                                (default value)
                               [option '-dbSSL' (enable SSL connection to DB)]                                     ORION_MONGO_SSL                 FALSE /FALSE/                                                          (default value)
                               [option '-db' <database name>]                                                      ORION_MONGO_DB                  'orion' /'orion'/                                                      (default value)
                               [option '-dbTimeout' <timeout in milliseconds for connections to the replica set]   ORION_MONGO_TIMEOUT             10000.000000 /10000.000000/                                            (default value)
                               [option '-dbPoolSize' <database connection pool size>]                              ORION_MONGO_POOL_SIZE           1 <= 10 /10/ <= 10000                                                  (default value)
                               [option '-ipv4' (use ip v4 only)]                                                   ORION_USEIPV4                   FALSE /FALSE/                                                          (default value)
                               [option '-ipv6' (use ip v6 only)]                                                   ORION_USEIPV6                   FALSE /FALSE/                                                          (default value)
                               [option '-https' (use the https 'protocol')]                                        ORION_HTTPS                     FALSE /FALSE/                                                          (default value)
                               [option '-key' <private server key file (for https)>]                               ORION_HTTPS_KEYFILE             '' /''/                                                                (default value)
                               [option '-cert' <certificate key file (for https)>]                                 ORION_HTTPS_CERTFILE            '' /''/                                                                (default value)
                               [option '-multiservice' (service multi tenancy mode)]                               ORION_MULTI_SERVICE             FALSE /FALSE/                                                          (default value)
                               [option '-httpTimeout' <timeout in milliseconds for forwards and notifications>]    ORION_HTTP_TIMEOUT              -1 <= -1 /-1/ <= 900000                                                (default value)
                               [option '-reqTimeout' <connection timeout for REST requests (in seconds)>]          ORION_REQ_TIMEOUT               0 /0/ >= 0                                                             (default value)
                               [option '-reqMutexPolicy' <mutex policy (none/read/write/all)>]                     ORION_MUTEX_POLICY              'all' /'all'/                                                          (default value)
                               [option '-writeConcern' <db write concern (0:unacknowledged, 1:acknowledged)>]      ORION_MONGO_WRITE_CONCERN       0 <= 1 /1/ <= 1                                                        (default value)
                               [option '-corsOrigin' <enable Cross-Origin Resource Sharing with allowed origin.]   ORION_CORS_ALLOWED_ORIGIN       '' /''/                                                                (default value)
                               [option '-corsMaxAge' <maximum time in seconds preflight requests are allowed to]   ORION_CORS_MAX_AGE              -1 <= 86400 /86400/ <= 86400                                           (default value)
                               [option '-cprForwardLimit' <maximum number of forwarded requests to Context Prov]   ORION_CPR_FORWARD_LIMIT         0 <= 1000 /1000/ <= 4294967295                                         (default value)
                               [option '-subCacheIval' <interval in seconds between calls to Subscription Cache]   ORION_SUBCACHE_IVAL             0 <= 60 /60/ <= 3600                                                   (default value)
                               [option '-noCache' (disable subscription cache for lookups)]                        ORION_NOCACHE                   FALSE /FALSE/                                                          (default value)
                               [option '-connectionMemory' <maximum memory size per connection (in kilobytes)>]    ORION_CONN_MEMORY               0 <= 64 /64/ <= 1024                                                   (default value)
                               [option '-maxConnections' <maximum number of simultaneous connections>]             ORION_MAX_CONN                  1020 /1020/ >= 1                                                       (default value)
                               [option '-reqPoolSize' <size of thread pool for incoming connections>]              ORION_TRQ_POOL_SIZE             0 <= 0 /0/ <= 1024                                                     (default value)
                               [option '-inReqPayloadMaxSize' <maximum size (in bytes) of the payload of incomi]   ORION_IN_REQ_PAYLOAD_MAX_SIZE   1048576 /1048576/ >= 0                                                 (default value)
                               [option '-outReqMsgMaxSize' <maximum size (in bytes) of outgoing forward and not]   ORION_OUT_REQ_MSG_MAX_SIZE      8388608 /8388608/ >= 0                                                 (default value)
                               [option '-notificationMode' <notification mode (persistent|transient|threadpool:]   ORION_NOTIF_MODE                'transient' /'transient'/                                              (default value)
                               [option '-notifFlowControl' <notification flow control parameters (gauge:stepDel]   ORION_NOTIF_FLOW_CONTROL        '' /''/                                                                (default value)
                               [option '-simulatedNotification' (simulate notifications instead of actual sendi]   ORION_DROP_NOTIF                FALSE /FALSE/                                                          (default value)
                               [option '-statCounters' (enable request/notification counters statistics)]          ORION_STAT_COUNTERS             FALSE /FALSE/                                                          (default value)
                               [option '-statSemWait' (enable semaphore waiting time statistics)]                  ORION_STAT_SEM_WAIT             FALSE /FALSE/                                                          (default value)
                               [option '-statTiming' (enable request-time-measuring statistics)]                   ORION_STAT_TIMING               FALSE /FALSE/                                                          (default value)
                               [option '-statNotifQueue' (enable thread pool notifications queue statistics)]      ORION_STAT_NOTIF_QUEUE          FALSE /FALSE/                                                          (default value)
                               [option '-logSummary' <log summary period in seconds (defaults to 0, meaning 'of]   ORION_LOG_SUMMARY_PERIOD        0 <= 0 /0/ <= 2678400                                                  (default value)
                               [option '-relogAlarms' (log messages for existing alarms beyond the raising alar]   ORION_RELOG_ALARMS              FALSE /FALSE/                                                          (default value)
                               [option '-strictNgsiv1Ids' (additional checks for id fields in the NGSIv1 API)]     ORION_CHECK_ID_V1               FALSE /FALSE/                                                          (default value)
                               [option '-disableCustomNotifications' (disable NGSIv2 custom notifications)]        ORION_DISABLE_CUSTOM_NOTIF      FALSE /FALSE/                                                          (default value)
                               [option '-logForHumans' (human readible log to screen)]                             ORION_LOG_FOR_HUMANS            FALSE /FALSE/                                                          (default value)
                               [option '-disableMetrics' (turn off the 'metrics' feature)]                         ORION_DISABLE_METRICS           FALSE /FALSE/                                                          (default value)
                               [option '-insecureNotif' (allow HTTPS notifications to peers which certificate c]   ORION_INSECURE_NOTIF            FALSE /FALSE/                                                          (default value)
                               [option '-ngsiv1Autocast' (automatic cast for number, booleans and dates in NGSI]   ORION_NGSIV1_AUTOCAST           FALSE /FALSE/                                                          (default value)



02. Set three env vars and add a few CLI params and with that - get the extended usage - see the origin and value of the modified parameters
============================================================================================================================================
Extended Usage: contextBroker  [option '-U' (extended usage)]                                                                                      TRUE /FALSE/                                                           (command line argument)
                               [option '-u' (usage)]                                                                                               FALSE /FALSE/                                                          (default value)
                               [option '--help' (show help)]                                                                                       FALSE /FALSE/                                                          (default value)
                               [option '--version' (show version)]                                                                                 FALSE /FALSE/                                                          (default value)
                               [option '-logDir' <log file directory>]                                             ORION_LOG_DIR                   '/tmp/'                                                                (not altered)
                               [option '-t' <trace level>]                                                         ORION_TRACE                     '' /'(null)'/                                                          (default value)
                               [option '-logLevel' <initial log level (NONE, FATAL, ERROR, WARN, INFO, DEBUG)>]    ORION_LOG_LEVEL                 'DEBUG' /'DEBUG'/                                                      (command line argument)
                               [option '-logAppend' (append to log-file)]                                          ORION_LOG_APPEND                FALSE /FALSE/                                                          (default value)
                               [option '-fg' (don't start as daemon)]                                              ORION_FOREGROUND                TRUE /FALSE/                                                           (command line argument)
                               [option '-localIp' <IP to receive new connections>]                                 ORION_LOCALIP                   '0.0.0.0' /'0.0.0.0'/                                                  (default value)
                               [option '-port' <port to receive new connections>]                                  ORION_PORT                      1026 /1026/                                                            (default value)
                               [option '-pidpath' <pid file path>]                                                 ORION_PID_PATH                  '/opt/orion/orion.pid' /'/tmp/contextBroker/                           (command line argument)
                               [option '-dbhost' <database host>]                                                  ORION_MONGO_HOST                'localhost' /'localhost'/                                              (default value)
                               [option '-rplSet' <replica set>]                                                    ORION_MONGO_REPLICA_SET         '' /''/                                                                (default value)
                               [option '-dbuser' <database user>]                                                  ORION_MONGO_USER                '' /''/                                                                (default value)
                               [option '-dbpwd' <database password>]                                               ORION_MONGO_PASSWORD            '' /''/                                                                (default value)
                               [option '-dbAuthMech' <database authentication mechanism (either SCRAM-SHA-1 or ]   ORION_MONGO_AUTH_MECH           'SCRAM-SHA-1' /'SCRAM-SHA-1'/                                          (default value)
                               [option '-dbAuthDb' <database used for authentication>]                             ORION_MONGO_AUTH_SOURCE         '' /''/                                                                (default value)
                               [option '-dbSSL' (enable SSL connection to DB)]                                     ORION_MONGO_SSL                 FALSE /FALSE/                                                          (default value)
                               [option '-db' <database name>]                                                      ORION_MONGO_DB                  'orion' /'orion'/                                                      (default value)
                               [option '-dbTimeout' <timeout in milliseconds for connections to the replica set]   ORION_MONGO_TIMEOUT             10000.000000 /10000.000000/                                            (default value)
                               [option '-dbPoolSize' <database connection pool size>]                              ORION_MONGO_POOL_SIZE           1 <= 10 /10/ <= 10000                                                  (default value)
                               [option '-ipv4' (use ip v4 only)]                                                   ORION_USEIPV4                   FALSE /FALSE/                                                          (default value)
                               [option '-ipv6' (use ip v6 only)]                                                   ORION_USEIPV6                   FALSE /FALSE/                                                          (default value)
                               [option '-https' (use the https 'protocol')]                                        ORION_HTTPS                     FALSE /FALSE/                                                          (default value)
                               [option '-key' <private server key file (for https)>]                               ORION_HTTPS_KEYFILE             '' /''/                                                                (default value)
                               [option '-cert' <certificate key file (for https)>]                                 ORION_HTTPS_CERTFILE            '' /''/                                                                (default value)
                               [option '-multiservice' (service multi tenancy mode)]                               ORION_MULTI_SERVICE             FALSE /FALSE/                                                          (default value)
                               [option '-httpTimeout' <timeout in milliseconds for forwards and notifications>]    ORION_HTTP_TIMEOUT              -1 <= 100 /-1/ <= 900000                                               (environment variable)
                               [option '-reqTimeout' <connection timeout for REST requests (in seconds)>]          ORION_REQ_TIMEOUT               20 /0/ >= 0                                                            (environment variable)
                               [option '-reqMutexPolicy' <mutex policy (none/read/write/all)>]                     ORION_MUTEX_POLICY              'all' /'all'/                                                          (default value)
                               [option '-writeConcern' <db write concern (0:unacknowledged, 1:acknowledged)>]      ORION_MONGO_WRITE_CONCERN       0 <= 1 /1/ <= 1                                                        (default value)
                               [option '-corsOrigin' <enable Cross-Origin Resource Sharing with allowed origin.]   ORION_CORS_ALLOWED_ORIGIN       '' /''/                                                                (default value)
                               [option '-corsMaxAge' <maximum time in seconds preflight requests are allowed to]   ORION_CORS_MAX_AGE              -1 <= 86400 /86400/ <= 86400                                           (default value)
                               [option '-cprForwardLimit' <maximum number of forwarded requests to Context Prov]   ORION_CPR_FORWARD_LIMIT         0 <= 1000 /1000/ <= 4294967295                                         (default value)
                               [option '-subCacheIval' <interval in seconds between calls to Subscription Cache]   ORION_SUBCACHE_IVAL             0 <= 60 /60/ <= 3600                                                   (default value)
                               [option '-noCache' (disable subscription cache for lookups)]                        ORION_NOCACHE                   FALSE /FALSE/                                                          (default value)
                               [option '-connectionMemory' <maximum memory size per connection (in kilobytes)>]    ORION_CONN_MEMORY               0 <= 64 /64/ <= 1024                                                   (default value)
                               [option '-maxConnections' <maximum number of simultaneous connections>]             ORION_MAX_CONN                  1020 /1020/ >= 1                                                       (default value)
                               [option '-reqPoolSize' <size of thread pool for incoming connections>]              ORION_TRQ_POOL_SIZE             0 <= 0 /0/ <= 1024                                                     (default value)
                               [option '-inReqPayloadMaxSize' <maximum size (in bytes) of the payload of incomi]   ORION_IN_REQ_PAYLOAD_MAX_SIZE   1024 /1048576/ >= 0                                                    (environment variable)
                               [option '-outReqMsgMaxSize' <maximum size (in bytes) of outgoing forward and not]   ORION_OUT_REQ_MSG_MAX_SIZE      8388608 /8388608/ >= 0                                                 (default value)
                               [option '-notificationMode' <notification mode (persistent|transient|threadpool:]   ORION_NOTIF_MODE                'transient' /'transient'/                                              (default value)
                               [option '-notifFlowControl' <notification flow control parameters (gauge:stepDel]   ORION_NOTIF_FLOW_CONTROL        '' /''/                                                                (default value)
                               [option '-simulatedNotification' (simulate notifications instead of actual sendi]   ORION_DROP_NOTIF                FALSE /FALSE/                                                          (default value)
                               [option '-statCounters' (enable request/notification counters statistics)]          ORION_STAT_COUNTERS             FALSE /FALSE/                                                          (default value)
                               [option '-statSemWait' (enable semaphore waiting time statistics)]                  ORION_STAT_SEM_WAIT             FALSE /FALSE/                                                          (default value)
                               [option '-statTiming' (enable request-time-measuring statistics)]                   ORION_STAT_TIMING               FALSE /FALSE/                                                          (default value)
                               [option '-statNotifQueue' (enable thread pool notifications queue statistics)]      ORION_STAT_NOTIF_QUEUE          FALSE /FALSE/                                                          (default value)
                               [option '-logSummary' <log summary period in seconds (defaults to 0, meaning 'of]   ORION_LOG_SUMMARY_PERIOD        0 <= 0 /0/ <= 2678400                                                  (default value)
                               [option '-relogAlarms' (log messages for existing alarms beyond the raising alar]   ORION_RELOG_ALARMS              FALSE /FALSE/                                                          (default value)
                               [option '-strictNgsiv1Ids' (additional checks for id fields in the NGSIv1 API)]     ORION_CHECK_ID_V1               FALSE /FALSE/                                                          (default value)
                               [option '-disableCustomNotifications' (disable NGSIv2 custom notifications)]        ORION_DISABLE_CUSTOM_NOTIF      FALSE /FALSE/                                                          (default value)
                               [option '-logForHumans' (human readible log to screen)]                             ORION_LOG_FOR_HUMANS            FALSE /FALSE/                                                          (default value)
                               [option '-disableMetrics' (turn off the 'metrics' feature)]                         ORION_DISABLE_METRICS           FALSE /FALSE/                                                          (default value)
                               [option '-insecureNotif' (allow HTTPS notifications to peers which certificate c]   ORION_INSECURE_NOTIF            FALSE /FALSE/                                                          (default value)
                               [option '-ngsiv1Autocast' (automatic cast for number, booleans and dates in NGSI]   ORION_NGSIV1_AUTOCAST           FALSE /FALSE/                                                          (default value)



--TEARDOWN--
