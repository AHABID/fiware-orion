url="/NGSI10/unsubscribeContext"
payload='<?xml version="1.0" encoding="UTF-8"?>
<unsubscribeContextRequest>
  <subscriptionId>012345678901234567890123</subscriptionId>
</unsubscribeContextRequest>'
curlXml ${url} "${payload}"

echo "2: ***********************************"

url="/NGSI10/subscribeContext"
payload='<?xml version="1.0" encoding="UTF-8"?>
<subscribeContextRequest>
  <entityIdList>
  <entityId type="Room" isPattern="false">
    <id>ConferenceRoom</id>   
  </entityId>
  <entityId type="Room" isPattern="false">
    <id>OfficeRoom</id>   
  </entityId>
  </entityIdList>
  <attributeList>
  <attribute>temperature</attribute>
  <attribute>lightstatus</attribute>
  </attributeList>
  <reference>http://127.0.0.1:1028</reference>
  <duration>P5Y</duration>
  <restriction>
  <attributeExpression>testRestriction</attributeExpression>
  <scope>
    <operationScope>
    <scopeType>scope1</scopeType>
    <scopeValue>sval1</scopeValue>
    </operationScope>
    <operationScope>
    <scopeType>scope2</scopeType>
    <scopeValue>sval2</scopeValue>
    </operationScope>
  </scope>
  </restriction>
  <notifyConditions>
  <notifyCondition>
    <type>ONTIMEINTERVAL</type>
    <condValueList>
    <condValue>PT10S</condValue>
    </condValueList>
    <restriction>restriction</restriction>
  </notifyCondition>
  </notifyConditions>
  <throttling>P5Y</throttling>
</subscribeContextRequest>'
curlXml ${url} "${payload}"

subscriptionId=$(echo "$response" | grep subscriptionId | awk -F '>' '{print $2}' | awk -F '<' '{print $1}' | grep -v '^$' )

echo "3: ***********************************"
url="/NGSI10/unsubscribeContext"
payload='<?xml version="1.0" encoding="UTF-8"?>
<unsubscribeContextRequest>
  <subscriptionId>'$subscriptionId'</subscriptionId>
</unsubscribeContextRequest>'

curlXml "$url" "$payload"

echo "4: ***********************************"
