if: branch = master and type IN (pull_request)
language: cpp
services:
  - docker
env:
before_install: true
install: true
before_script: true
script: true
jobs:
  include:
    - stage: compliance
      script: ci/rpm7/build.sh -c -p $(pwd)
    - stage: unit
      before_script: docker run -t --rm -v $(pwd):/opt/fiware-orion fiware/orion-ci:rpm7 build -M unit
      script: docker run -t --rm -v $(pwd):/opt/fiware-orion fiware/orion-ci:rpm7 build -IDu
    - stage: functional
      before_script:
        - echo '{"ipv6":true,"fixed-cidr-v6":"2001:db8:1::/64"}' | sudo tee /etc/docker/daemon.json
        - sudo service docker restart
        - docker run -t --rm -v $(pwd):/opt/fiware-orion fiware/orion-ci:rpm7 build -M functional
      script: docker run -t --rm -v $(pwd):/opt/fiware-orion fiware/orion-ci:rpm7 build -IDf
